<?php
session_start();

// Base de datos
$users = array(
    array(
        "id" => 1,
        "name" => "Admin",
        "email" => "felixmanuel17@gmail.com",
        "password" => "MANTIS MDd1"
    )
);

// Registro de usuario
if (isset($_POST['register'])) {
    $name = $_POST['name'];
    $email = $_POST['email'];
    $password = $_POST['password'];

    // Verificar si el email ya existe
    foreach ($users as $user) {
        if ($user['email'] == $email) {
            echo "El email ya existe";
            exit;
        }
    }

    // Agregar el nuevo usuario
    $newUser = array(
        "id" => count($users) + 1,
        "name" => $name,
        "email" => $email,
        "password" => $password
    );
    array_push($users, $newUser);
}

// Inicio de sesión
if (isset($_POST['login'])) {
    $email = $_POST['email'];
    $password = $_POST['password'];

    // Verificar las credenciales
    foreach ($users as $user) {
        if ($user['email'] == $email && $user['password'] == $password) {
            $_SESSION['loggedin'] = true;
            $_SESSION['username'] = $user['name'];
            header("Location: index.php");
            exit;
        }
    }

    echo "Usuario o contraseña incorrecta";
}

// Verificar si el usuario está logueado
if (isset($_SESSION['loggedin'])) {
    echo "Hola, bienvenido " . $_SESSION['username'];
    echo "<br><a href='index.php?logout=true'>Cerrar sesión</a>";

    // Cerrar sesión
    if (isset($_GET['logout'])) {
        session_destroy();
        header("Location: index.php");
        exit;
    }
} else {
    ?>
    <h2>Login</h2>
    <form action="" method="post">
        <label>Email:</label>
        <input type="email" name="email"><br><br>
        <label>Contraseña:</label>
        <input type="password" name="password"><br><br>
        <input type="submit" name="login" value="Iniciar sesión">
    </form>
    <p>¿No tienes cuenta? <a href="?register=true">Registra aquí</a></p>

    <?php if (isset($_GET['register'])) { ?>
        <h2>Registro</h2>
        <form action="" method="post">
            <label>Nombre:</label>
            <input type="text" name="name"><br><br>
            <label>Email:</label>
            <input type="email" name="email"><br><br>
            <label>Contraseña:</label>
            <input type="password" name="password"><br><br>
            <input type="submit" name="register" value="Registrarse">
        </form>
    <?php } ?>
<?php } ?>
