window.Slip=function(){"use strict";function e(){}var i={container:{role:"listbox",tabIndex:0,focus:!1},items:{role:"option",tabIndex:-1,focus:!1}},t=/Chrome\/[3-5]/.test(navigator.userAgent),o=t,p=t,l="transition"in(t=document.createElement("div").style)?"transition":"webkitTransition",d="transform"in t?"transform":"webkitTransform",u="webkitTransform"==d?"-webkit-transform":"transform",f="userSelect"in t?"userSelect":"webkitUserSelect",m=(t[d]="translateZ(0)",t[d]?"translateZ(0) ":""),v=t[d]?"translateZ(1px) ":"",t=null,a=0,n=!1;function s(t,e){if(!(t="string"==typeof t?document.querySelector(t):t)||!t.addEventListener)throw new Error("Please specify DOM node to attach to");if(!this||this===window)return new s(t,e);if(this.options=e=e||{},this.options.keepSwipingPercent=e.keepSwipingPercent||0,this.options.minimumSwipeVelocity=e.minimumSwipeVelocity||1,this.options.minimumSwipeTime=e.minimumSwipeTime||110,this.options.ignoredElements=e.ignoredElements||[],this.options.accessibility=e.accessibility||i,this.options.accessibility.container=e.accessibility.container||i.container,this.options.accessibility.container.role=(void 0!==e.accessibility.container.role?e.accessibility:i).container.role,this.options.accessibility.container.tabIndex=(void 0!==e.accessibility.container.tabIndex?e.accessibility:i).container.tabIndex,this.options.accessibility.container.focus=(void 0!==e.accessibility.container.focus?e.accessibility:i).container.focus,this.options.accessibility.items=e.accessibility.items||i.items,this.options.accessibility.items.role=(void 0!==e.accessibility.items.role?e.accessibility:i).items.role,this.options.accessibility.items.tabIndex=(void 0!==e.accessibility.items.tabIndex?e.accessibility:i).items.tabIndex,this.options.accessibility.items.role=(void 0!==e.accessibility.items.focus?e.accessibility:i).items.focus,!Array.isArray(this.options.ignoredElements))throw new Error("ignoredElements must be an Array");this.cancel=this.setState.bind(this,this.states.idle),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onSelection=this.onSelection.bind(this),this.onContainerFocus=this.onContainerFocus.bind(this),this.setState(this.states.idle),this.attach(t)}function g(t){var e=t.style[d];if(e)return{value:e,original:e};if(window.getComputedStyle){e=window.getComputedStyle(t).getPropertyValue(u);if(e&&"none"!==e)return{value:e,original:""}}return{value:"",original:""}}function b(t,e){for(var i=0,n=0,s=0;s<e.length;s++)1===e[s].nodeType&&(n++,e[s]===t.node&&(i=n-1));return i}return s.prototype={container:null,options:{},state:null,target:null,usingTouch:!1,mouseHandlersAttached:!1,startPosition:null,latestPosition:null,previousPosition:null,canPreventScrolling:!1,states:{idle:function(){return this.removeMouseHandlers(),this.target&&(this.target.node.style.willChange="",this.target=null),{allowTextSelection:!(this.usingTouch=!1)}},undecided:function(){var t;return this.target.height=this.target.node.offsetHeight,this.target.node.style.willChange=u,this.target.node.style[l]="",this.dispatch(this.target.originalTarget,"beforewait")?t=setTimeout(function(){var t=this.getAbsoluteMovement();this.canPreventScrolling&&t.x<15&&t.y<25&&this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder)}.bind(this),300):this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder),{leaveState:function(){clearTimeout(t)},onMove:function(){var t=this.getAbsoluteMovement();if(20<t.x&&t.y<Math.max(100,this.target.height)){if(this.dispatch(this.target.originalTarget,"beforeswipe",{directionX:t.directionX,directionY:t.directionY}))return this.setState(this.states.swipe),!1;this.setState(this.states.idle)}if(20<t.y&&this.setState(this.states.idle),t.x>1.2*t.y)return!1},onLeave:function(){this.setState(this.states.idle)},onEnd:function(){var t=this.dispatch(this.target.originalTarget,"tap");return this.setState(this.states.idle),t}}},swipe:function(){var n=!1,t=this.container,s=b(this.target,this.container.childNodes);function e(){t.classList.remove("slip-swiping-container")}return t.classList.add("slip-swiping-container"),this.target.height=this.target.node.offsetHeight,{leaveState:function(){n?this.animateSwipe(function(t){if(t.node.style[d]=t.baseTransform.original,t.node.style[l]="",this.dispatch(t.node,"afterswipe"))return e(),!0;this.animateToZero(void 0,t)}.bind(this)):this.animateToZero(e)},onMove:function(){var t=this.getTotalMovement();if(Math.abs(t.y)<this.target.height+20)return this.dispatch(this.target.node,"animateswipe",{x:t.x,originalIndex:s})&&(this.target.node.style[d]="translate("+t.x+"px,0) "+m+this.target.baseTransform.value),!1;this.dispatch(this.target.node,"cancelswipe"),this.setState(this.states.idle)},onLeave:function(){this.state.onEnd.call(this)},onEnd:function(){var t=this.getAbsoluteMovement(),e=t.x/t.time,i=100*Math.abs((this.startPosition.x-this.previousPosition.x)/this.container.clientWidth),e=e>this.options.minimumSwipeVelocity&&t.time>this.options.minimumSwipeTime||this.options.keepSwipingPercent&&i>this.options.keepSwipingPercent;return e?this.dispatch(this.target.node,"swipe",{direction:t.directionX,originalIndex:s})&&(n=!0):this.dispatch(this.target.node,"cancelswipe"),this.setState(this.states.idle),!e}}},reorder:function(){var t;if(this.target.node.focus&&this.options.accessibility.items.focus&&this.target.node.focus(),this.target.height=this.target.node.offsetHeight,this.options.ignoredElements.length){var e=this.container,i=e.tagName.toLowerCase();e.getAttribute("id")?i="#"+e.getAttribute("id"):e.classList.length&&(i+="."+e.getAttribute("class").replace(" ",".")),i+=" > ",this.options.ignoredElements.forEach(function(t){i+=":not("+t+")"});try{t=e.parentNode.querySelectorAll(i)}catch(t){throw t instanceof DOMException&&"SyntaxError"===t.name?new Error("ignoredElements you specified contain invalid query"):t}}else t=this.container.childNodes;for(var s,n,o=b(this.target,t),a=this.target.node.offsetTop+this.target.height/2,r=[],h=0;h<t.length;h++)1==t[h].nodeType&&t[h]!==this.target.node&&(n=t[h].offsetTop,t[h].style[l]=u+" 0.2s ease-in-out",r.push({node:t[h],baseTransform:g(t[h]),pos:n+(n<a?t[h].offsetHeight:0)-a}));function c(){this.updateScrolling(),s&&(clearTimeout(s),s=null);var i=this.getTotalMovement(),n=(this.target.node.style[d]="translate(0,"+i.y+"px) "+v+this.target.baseTransform.value,this.target.height);return r.forEach(function(t){var e=0;t.pos<0&&i.y<0&&t.pos>i.y?e=n:0<t.pos&&0<i.y&&t.pos<i.y&&(e=-n),t.node.style[d]=e?"translate(0,"+e+"px) "+m+t.baseTransform.value:t.baseTransform.original}),!1}return this.target.node.classList.add("slip-reordering"),this.target.node.style.zIndex="99999",this.target.node.style[f]="none",p&&(this.container.style.webkitTransformStyle="preserve-3d"),c.call(this),{leaveState:function(){s&&clearTimeout(s),p&&(this.container.style.webkitTransformStyle=""),this.container.focus&&this.options.accessibility.container.focus&&this.container.focus(),this.target.node.classList.remove("slip-reordering"),this.target.node.style[f]="",this.animateToZero(function(t){t.node.style.zIndex=""}),r.forEach(function(t){t.node.style[d]=t.baseTransform.original,t.node.style[l]=""})},onMove:c,onLeave:function(){s&&clearTimeout(s),s=setTimeout(function(){s=null,this.cancel()}.bind(this),700)},onEnd:function(){var t,e,i=this.getTotalMovement();if(i.y<0){for(t=0;t<r.length&&!(r[t].pos>i.y);t++);e=t}else{for(t=r.length-1;0<=t&&!(r[t].pos<i.y);t--);e=t+1}return this.dispatch(this.target.node,"reorder",{spliceIndex:e,originalIndex:o,insertBefore:r[e]?r[e].node:null}),this.setState(this.states.idle),!1}}}},attach:function(t){a++,this.container&&this.detach(),!n&&o&&(n=!0,document.body.addEventListener("touchstart",e,!1)),this.container=t,!1!==this.options.accessibility.container.tabIndex&&(this.container.tabIndex=this.options.accessibility.container.tabIndex),this.options.accessibility.container.role&&this.container.setAttribute("role",this.options.accessibility.container.role),this.setChildNodesRoles(),this.container.addEventListener("focus",this.onContainerFocus,!1),this.otherNodes=[],document.addEventListener("selectionchange",this.onSelection,!1),this.container.addEventListener("touchcancel",this.cancel,!1),this.container.addEventListener("touchstart",this.onTouchStart,!1),this.container.addEventListener("touchmove",this.onTouchMove,!1),this.container.addEventListener("touchend",this.onTouchEnd,!1),this.container.addEventListener("mousedown",this.onMouseDown,!1)},detach:function(){this.cancel(),this.container.removeEventListener("mousedown",this.onMouseDown,!1),this.container.removeEventListener("touchend",this.onTouchEnd,!1),this.container.removeEventListener("touchmove",this.onTouchMove,!1),this.container.removeEventListener("touchstart",this.onTouchStart,!1),this.container.removeEventListener("touchcancel",this.cancel,!1),document.removeEventListener("selectionchange",this.onSelection,!1),!1!==this.options.accessibility.container.tabIndex&&this.container.removeAttribute("tabIndex"),this.options.accessibility.container.role&&this.container.removeAttribute("role"),this.unSetChildNodesRoles(),!--a&&n&&(n=!1,document.body.removeEventListener("touchstart",e,!1))},setState:function(t){if(this.state){if(this.state.ctor===t)return;this.state.leaveState&&this.state.leaveState.call(this)}var e=this.state,i=t.call(this);this.state===e&&(i.ctor=t,this.state=i)},findTargetNode:function(t){for(;t&&t.parentNode!==this.container;)t=t.parentNode;return t},onContainerFocus:function(t){t.stopPropagation(),this.setChildNodesRoles()},setChildNodesRoles:function(){for(var t=this.container.childNodes,e=0;e<t.length;e++)1==t[e].nodeType&&(this.options.accessibility.items.role&&t[e].setAttribute("role",this.options.accessibility.items.role),!1!==this.options.accessibility.items.tabIndex&&(t[e].tabIndex=this.options.accessibility.items.tabIndex))},unSetChildNodesRoles:function(){for(var t=this.container.childNodes,e=0;e<t.length;e++)1==t[e].nodeType&&(this.options.accessibility.items.role&&t[e].removeAttribute("role"),!1!==this.options.accessibility.items.tabIndex&&t[e].removeAttribute("tabIndex"))},onSelection:function(t){t.stopPropagation();var e=t.target===document||this.findTargetNode(t),i=/(iPhone|iPad|iPod)/i.test(navigator.userAgent)&&!/(Android|Windows)/i.test(navigator.userAgent);e&&(i?this.setState(this.states.idle):this.state.allowTextSelection||t.preventDefault())},addMouseHandlers:function(){this.mouseHandlersAttached||(this.mouseHandlersAttached=!0,document.documentElement.addEventListener("mouseleave",this.onMouseLeave,!1),window.addEventListener("mousemove",this.onMouseMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),window.addEventListener("blur",this.cancel,!1))},removeMouseHandlers:function(){this.mouseHandlersAttached&&(this.mouseHandlersAttached=!1,document.documentElement.removeEventListener("mouseleave",this.onMouseLeave,!1),window.removeEventListener("mousemove",this.onMouseMove,!0),window.removeEventListener("mouseup",this.onMouseUp,!0),window.removeEventListener("blur",this.cancel,!1))},onMouseLeave:function(t){t.stopPropagation(),this.usingTouch||t.target!==document.documentElement&&t.relatedTarget!==document.documentElement||this.state.onLeave&&this.state.onLeave.call(this)},onMouseDown:function(t){t.stopPropagation(),!this.usingTouch&&0==t.button&&this.setTarget(t)&&(this.addMouseHandlers(),this.canPreventScrolling=!0,this.startAtPosition({x:t.clientX,y:t.clientY,time:t.timeStamp}))},onTouchStart:function(t){t.stopPropagation(),this.usingTouch=!0,this.canPreventScrolling=!0,1<t.touches.length?this.setState(this.states.idle):this.setTarget(t)&&this.startAtPosition({x:t.touches[0].clientX,y:t.touches[0].clientY,time:t.timeStamp})},setTarget:function(t){var e=this.findTargetNode(t.target);if(!e)return this.setState(this.states.idle),!1;if(!(n=this.options.scrollContainer)){for(var i=document.scrollingElement||document.documentElement,n=e.parentNode;n&&n!=i&&!(n!=document.body&&n.scrollHeight>n.clientHeight&&"visible"!=window.getComputedStyle(n)["overflow-y"]);)n=n.parentNode;n=n||i}return this.target={originalTarget:t.target,node:e,scrollContainer:n,origScrollTop:n.scrollTop,origScrollHeight:n.scrollHeight,baseTransform:g(e)},!0},startAtPosition:function(t){this.startPosition=this.previousPosition=this.latestPosition=t,this.setState(this.states.undecided)},updatePosition:function(t,e){null!=this.target&&(this.latestPosition=e,this.state.onMove&&!1===this.state.onMove.call(this)&&t.preventDefault(),100<this.latestPosition.time-this.previousPosition.time&&(this.previousPosition=this.latestPosition))},onMouseMove:function(t){t.stopPropagation(),this.updatePosition(t,{x:t.clientX,y:t.clientY,time:t.timeStamp})},onTouchMove:function(t){t.stopPropagation(),this.updatePosition(t,{x:t.touches[0].clientX,y:t.touches[0].clientY,time:t.timeStamp}),this.canPreventScrolling=!1},onMouseUp:function(t){t.stopPropagation(),this.usingTouch||0!==t.button||this.state.onEnd&&!1===this.state.onEnd.call(this)&&t.preventDefault()},onTouchEnd:function(t){t.stopPropagation(),1<t.touches.length?this.cancel():this.state.onEnd&&!1===this.state.onEnd.call(this)&&t.preventDefault()},getTotalMovement:function(){var t=this.target.scrollContainer.scrollTop-this.target.origScrollTop;return{x:this.latestPosition.x-this.startPosition.x,y:this.latestPosition.y-this.startPosition.y+t,time:this.latestPosition.time-this.startPosition.time}},getAbsoluteMovement:function(){var t=this.getTotalMovement();return{x:Math.abs(t.x),y:Math.abs(t.y),time:t.time,directionX:t.x<0?"left":"right",directionY:t.y<0?"up":"down"}},updateScrolling:function(){var t=0,e=this.target.scrollContainer,i=e.getBoundingClientRect(),n=this.target.node.getBoundingClientRect(),s=Math.min(i.bottom,window.innerHeight)-n.bottom,n=n.top-Math.max(i.top,0),i=this.target.origScrollHeight-Math.min(e.clientHeight,window.innerHeight);s<40?t=Math.min(40,40-s):n<40&&(t=Math.max(-40,n-40)),e.scrollTop=Math.max(0,Math.min(i,e.scrollTop+t))},dispatch:function(t,e,i){var n=document.createEvent("CustomEvent");return n&&n.initCustomEvent?n.initCustomEvent("slip:"+e,!0,!0,i):((n=document.createEvent("Event")).initEvent("slip:"+e,!0,!0),n.detail=i),t.dispatchEvent(n)},getSiblings:function(t){for(var e=[],i=t.node.nextSibling;i;)1==i.nodeType&&e.push({node:i,baseTransform:g(i)}),i=i.nextSibling;return e},animateToZero:function(t,e){(e=e||this.target).node.style[l]=u+" 0.1s ease-out",e.node.style[d]="translate(0,0) "+m+e.baseTransform.value,setTimeout(function(){e.node.style[l]="",e.node.style[d]=e.baseTransform.original,t&&t.call(this,e)}.bind(this),101)},animateSwipe:function(t){var e=this.target,i=this.getSiblings(e),n="translate(0,"+this.target.height+"px) "+m+" ";e.node.style[l]="all 0.1s linear",e.node.style[d]=" translate("+(0<this.getTotalMovement().x?"":"-")+"100%,0) "+m+e.baseTransform.value,setTimeout(function(){t.call(this,e)&&(i.forEach(function(t){t.node.style[l]="",t.node.style[d]=n+t.baseTransform.value}),setTimeout(function(){i.forEach(function(t){t.node.style[l]=u+" 0.1s ease-in-out",t.node.style[d]="translate(0,0) "+m+t.baseTransform.value}),setTimeout(function(){i.forEach(function(t){t.node.style[l]="",t.node.style[d]=t.baseTransform.original})},101)},1))}.bind(this),101)}},"function"==typeof define&&define.amd&&define(function(){return s}),"object"==typeof module&&module.exports&&(module.exports=s),s}();