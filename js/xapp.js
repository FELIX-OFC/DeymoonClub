var _gCurrentModal=null,_gCurrentPopPanel=null,_gDropDownMenuSelectedName=null,_gDropDownMenuShowed=!1;function emptyContent(e){(e=e||document.querySelector(".content")).innerHTML="<div class='content-state'><div class='empty-state-icon'></div><div class='content-state-text'>"+_XAPP_.getStringResource("web_str_no_data")+"</div></div>"}function lockedContent(e){(e=e||document.querySelector(".content")).innerHTML="<div class='content-state'><div class='locked-state-icon'></div><div class='content-state-text'>"+_XAPP_.getStringResource("web_str_not_yet_unlocked")+"</div></div>"}function openModalDialog(e){var e=document.querySelector("#"+e);e&&((_gCurrentModal=e).style.display="block",(e=e.querySelector(".modal-close")).removeEventListener("click",closeModalDialog),e.addEventListener("click",closeModalDialog))}function closeModalDialog(){_gCurrentModal&&(_gCurrentModal.style.display="none",_gCurrentModal=null)}function openPopPanel(e){var t=document.querySelector("#"+e),e=(t&&((_gCurrentPopPanel=t).style.display="block",history.pushState({panelId:e},""),window._popstateListener||(window._popstateListener=!0,window.addEventListener("popstate",function(e){_gCurrentPopPanel&&closePopPanel()}))),t.querySelector(".popup-back"));e.removeEventListener("click",goBack),e.addEventListener("click",goBack)}function goBack(){history.back()}function closePopPanel(){_gCurrentPopPanel&&(_gCurrentPopPanel.style.display="none",_gCurrentPopPanel=null)}function closeModalDialog(){_gCurrentModal&&(_gCurrentModal.style.display="none",sendEvent("event_dialog_close",{dialogId:_gCurrentModal.id}),_gCurrentModal=null)}function renderInfoBanner(e){var t,o;localStorage.getItem("info-banner."+e)!=e&&((t=document.querySelector(".content")).querySelector(".info-banner")||((o=document.createElement("div")).className="info-banner",o.innerHTML="<div class='info-icon'>i</div><div class='info-content'>"+_XAPP_.getStringResource(e)+"</div><label  class='close-button'>Ã—</label>",t.insertBefore(o,t.firstChild),o.querySelector(".close-button").addEventListener("click",function(){o.remove(),localStorage.setItem("info-banner."+e,e)})))}function fileType2Icon(e){return 1==e?"icon-folder":2==e?"icon-video":3==e?"icon-audio":4==e?"icon-mht":5==e?"icon-html":6==e?"icon-apk":7==e?"icon-image":8==e?"icon-text":9==e?"icon-pdf":10==e?"icon-zip":"icon-file"}function sendEvent(e,t={}){e=new CustomEvent(e,{detail:t});document.dispatchEvent(e)}window.addEventListener("click",function(e){e.target==_gCurrentModal&&closeModalDialog()}),window._XAPP_=function(){function S(e,t={}){var o;"event_page_to_app"==e?window.mbrowser&&mbrowser.dispatchEvent(e,JSON.stringify(t)):"event_app_to_page"==e?(o=new CustomEvent(e,{detail:JSON.parse(t)}),document.dispatchEvent(o)):sendEvent(e,t)}function v(e){return window.mbrowser?mbrowser.getStringResource(e):e}function A(e,t){var o=document.getElementById(e);o&&(console.log("set switchId:",e,"state:",t),o.checked=t),(window.mbrowser?mbrowser:localStorage).setItem("setting_boolean."+e,t)}function h(e){return window.mbrowser?"true"==mbrowser.getItem("setting_boolean."+e):"true"==localStorage.getItem("setting_boolean."+e)}function T(){for(var e=document.querySelectorAll("[data-option-group-name]"),t=0;t<e.length;t++){var o=e[t],n=o.getAttribute("data-option-group-name"),o=o.querySelector(".sub-label");o&&(n=n,(n=window.mbrowser?mbrowser.getSelectedOptionName(n):"")&&(o.innerHTML=n))}}return addEventListener("DOMContentLoaded",function(){for(var w=document.querySelectorAll(".switch"),e=0;e<w.length;e++){var t,o,n=w[e].querySelector("input");!n||(t=n.getAttribute("id"))&&(n.addEventListener("change",function(e){A(e.target.id,e.target.checked)}),o=h(t),console.log("switchId:",t,"state:",o),n.checked=o)}if(window.mbrowser){for(var u=document.querySelectorAll("[data-string-id]"),r=0;r<u.length;r++){var l=u[r],m=l.getAttribute("data-string-id");l.innerHTML=v(m)}for(var g=document.querySelectorAll("[data-placeholder-string-id]"),i=0;i<g.length;i++){var b=g[i],p=b.getAttribute("data-placeholder-string-id");b.setAttribute("placeholder",v(p))}T();for(var f=document.querySelectorAll("[data-transaction-id]"),_=0;_<f.length;_++)f[_].addEventListener("click",function(e){for(var t=this.getAttribute("data-transaction-id"),o={},n=(o.transId=t,this.attributes),r=0;r<n.length;r++){var i=n[r];"data-transaction-id"!=i.name&&0===i.name.indexOf("data-")&&(o[i.name]=i.value)}S("event_page_to_app",o)})}var s=document.querySelector(".dropdown-menu"),a=document.querySelector(".dropdown-content");if(null!=s&&null!=a){document.addEventListener("click",function(e){e.target.closest(".dropdown")||(a.classList.remove("show"),_gDropDownMenuShowed=!1)}),s.addEventListener("click",function(e){e.stopPropagation(),a.classList.toggle("show"),_gDropDownMenuShowed=!0}),document.addEventListener("click",function(e){a.contains(e.target)||(a.classList.remove("show"),_gDropDownMenuShowed=!1)}),a.addEventListener("click",function(e){var t;e.target.classList.contains("dropdown-item")&&(t=e.target.getAttribute("data-selected-item-name"),a.classList.remove("show"),_gDropDownMenuSelectedName=t,s.textContent=e.target.textContent,_gDropDownMenuShowed=!1,S("dropdown:select_item",{selectedItemName:t}))});for(var d=a.querySelectorAll(".dropdown-item"),c=0;c<d.length;c++)d[c].addEventListener("click",function(e){e.preventDefault();e=this.getAttribute("data-selected-item-name");_gDropDownMenuSelectedName=e}),d[c].getAttribute("data-selected-item-name")==_gDropDownMenuSelectedName&&(d[c].classList.add("selected"),s.textContent=d[c].textContent)}}),document.addEventListener("event_app_to_page",function(e){"option_changed"==e.detail.transId&&T()}),{init:function(){console.log("xapp init")},dispatchEvent:S,_str:function(e){window.mbrowser?document.write(mbrowser.getStringResource(e)):document.write(e)},getStringResource:v,getAppLogoUri:function(){return window.mbrowser?mbrowser.getAppLogoUri():""},getAdbLogs:function(e,t,o){return window.mbrowser?JSON.parse(mbrowser.getAdbLogs(e,t,o)):window._TEST_DATA_.adblock_logs},getHistories:function(e,t,o){return window.mbrowser?JSON.parse(mbrowser.getHistories(e,t,o)):window._TEST_DATA_.histories},getBookmarks:function(e,t,o){return window.mbrowser?JSON.parse(mbrowser.getBookmarks(e,t,o)):window._TEST_DATA_.bookmarks},getDownloadInfo:function(e){return window.mbrowser?JSON.parse(mbrowser.getDownloadInfo(e)):window._TEST_DATA_.download_info},getCustomAdRules:function(e,t,o){return window.mbrowser?JSON.parse(mbrowser.getCustomAdRules(e,t,o)):window._TEST_DATA_.custom_ad_rules},addCustomAdRule:function(e){window.mbrowser&&mbrowser.addCustomAdRule(e)},removeAdRule:function(e){window.mbrowser&&mbrowser.removeAdRule(e)},updateAdRule:function(e,t){window.mbrowser&&mbrowser.updateAdRule(e,t)},getPageResources:function(e,t){return window.mbrowser?JSON.parse(mbrowser.getResourceListWithJson(e,t)):window._TEST_DATA_.page_resources},getFiles:function(e,t){return window.mbrowser?JSON.parse(mbrowser.getFiles(e,t)):window._TEST_DATA_.files},getUserScriptByJson:function(e){return window.mbrowser?JSON.parse(mbrowser.getUserScriptByJson(e)):window._TEST_DATA_.user_scripts[0]},updateOrNewUserScript:function(e){window.mbrowser?mbrowser.updateOrNewUserScript(JSON.stringify(e)):window._TEST_DATA_.user_scripts.push(e)},getDomains:function(e){return window.mbrowser?JSON.parse(mbrowser.getDomains(parseInt(e))):window._TEST_DATA_.domain_list},addDomain:function(e,t,o){window.mbrowser&&mbrowser.addDomain(parseInt(e),t,o)},removeDomain:function(e,t){window.mbrowser&&mbrowser.removeDomain(parseInt(e),t)},openUrl:function(e,t,o){window.mbrowser?mbrowser.openUrl(e,t,o):window.location.href=e},getItem:function(e){var t=null;if(window.mbrowser?t=mbrowser.getItem(e):null==(t=localStorage.getItem(e))&&window._TEST_DATA_&&(t=window._TEST_DATA_[e]),0==e.indexOf("setting_boolean."))return"true"==t;if(0==e.indexOf("setting_number."))return parseInt(t);if(0==e.indexOf("setting_string."))return t;try{return JSON.parse(t)}catch(e){return t}},setItem:function(e,t){"object"==typeof t&&(t=JSON.stringify(t)),(window.mbrowser?mbrowser:localStorage).setItem(e,t)},getBrowserLayoutType:function(){return window.mbrowser?mbrowser.getBrowserLayoutType():"search-bar-at-top"},updateBrowserLayout:function(e){window.mbrowser&&mbrowser.updateBrowserLayout(e)},updateToolbarLayout:function(e,t){window.mbrowser&&mbrowser.updateToolbarLayout(e,t)},disableRule:function(e,t){window.mbrowser&&mbrowser.disableRule(e,t)},getCountAdbLogs:function(){return window.mbrowser?mbrowser.getCountAdbLogs():100},showToast:function(e){var t;window.mbrowser?(t=v(e),mbrowser.showToast(t)):alert(e)},numberOfRules:function(){return window.mbrowser?mbrowser.getTotalRules():1024},numberOfBlocked:function(){return window.mbrowser?mbrowser.numberOfBlocked():1024},loadAutoFill:function(e){return window.mbrowser?JSON.parse(mbrowser.loadAutoFill(e)):window._TEST_DATA_[e]},hasUnlocked:function(){return!!window.mbrowser&&mbrowser.hasUnlocked()},hasLogin:function(){return!!window.mbrowser&&mbrowser.hasLogin()},checkUpdate:function(){window.mbrowser&&mbrowser.checkUpdate()},getAvatarURI:function(){return window.mbrowser?mbrowser.getAvatarURI():""},setSwitchState:A,getSwitchState:h,getSiteSwitchState:function(e,t){return!!window.mbrowser&&mbrowser.getSiteSwitchState(e,t)},setSiteSwitchState:function(e,t,o){window.mbrowser&&mbrowser.setSiteSwitchState(e,t,o)},getSiteBindUATitle:function(e){return window.mbrowser?mbrowser.getSiteBindUATitle(e):""},removeAutoFill:function(e,t){window.mbrowser&&mbrowser.removeAutoFill(e,t)},updateAutoFill:function(e){window.mbrowser&&mbrowser.updateAutoFill(e)},unlockSuccess:function(){window.mbrowser&&mbrowser.unlockSuccess()},string2MD5:function(e){return window.mbrowser?mbrowser.string2MD5(e):""}}}();